# 3-1. èµ„æºæ¨¡å— - ResourceModule

## ğŸ“¦ æ¨¡å—æ¦‚è¿°

TEngine èµ„æºæ¨¡å—æ˜¯åŸºäº **YooAsset** æ„å»ºçš„ä¸Šå±‚èµ„æºç®¡ç†æ¡†æ¶ï¼Œæä¾›äº†**å®Œå…¨è‡ªåŠ¨åŒ–çš„èµ„æºå¼•ç”¨ç®¡ç†**å’Œ**å•†ä¸šçº§çš„èµ„æºç”Ÿå‘½å‘¨æœŸæ§åˆ¶**ã€‚ç›¸æ¯”ç›´æ¥ä½¿ç”¨ YooAssetï¼ŒTEngine çš„èµ„æºæ¨¡å—å…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š

### âœ¨ æ ¸å¿ƒä¼˜åŠ¿

1. **ğŸ”— èµ„æºå¼•ç”¨è‡ªåŠ¨åŒ–ç®¡ç†**
   - é€šè¿‡ `AssetsReference` ç»„ä»¶è‡ªåŠ¨ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
   - æ— éœ€æ‰‹åŠ¨ Dispose èµ„æºå¥æŸ„ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†èµ„æºé‡Šæ”¾
   - æ”¯æŒ GameObject å’Œèµ„æºå¯¹è±¡çš„è‡ªåŠ¨å¼•ç”¨è¿½è¸ª

2. **ğŸ“Š ä¸Šå±‚èµ„æºç®¡ç†æ¡†æ¶**
   - åŸºäº YooAsset æ„å»ºï¼Œä½†æä¾›äº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡
   - ç»Ÿä¸€çš„èµ„æºåŠ è½½æ¥å£ï¼Œå±è”½åº•å±‚å®ç°ç»†èŠ‚
   - æ™ºèƒ½çš„èµ„æºå¯¹è±¡æ± ç®¡ç†ï¼Œè‡ªåŠ¨å¤ç”¨å·²åŠ è½½èµ„æº

3. **ğŸ¯ å•†ä¸šçº§å†…å­˜ç®¡ç†**
   - æ”¯æŒ LRUï¼ˆLeast Recently Usedï¼‰ç¼“å­˜ç­–ç•¥
   - æ”¯æŒ ARCï¼ˆAdaptive Replacement Cacheï¼‰ç¼“å­˜ç­–ç•¥
   - è‡ªåŠ¨é‡Šæ”¾å¼•ç”¨è®¡æ•°ä¸º 0 çš„èµ„æºåŒ…
   - å¯é…ç½®çš„èµ„æºè‡ªåŠ¨é‡Šæ”¾é—´éš”

4. **ğŸš€ é«˜æ€§èƒ½å¼‚æ­¥åŠ è½½**
   - åŸºäº UniTask çš„é›¶ GC å¼‚æ­¥åŠ è½½
   - æ”¯æŒåŒæ­¥/å¼‚æ­¥/å›è°ƒä¸‰ç§åŠ è½½æ–¹å¼
   - æ™ºèƒ½çš„èµ„æºåŠ è½½é˜Ÿåˆ—ç®¡ç†

---

## ğŸ® è¿è¡Œæ¨¡å¼

èµ„æºæ¨¡å—æ”¯æŒå¤šç§è¿è¡Œæ¨¡å¼ï¼Œè¦†ç›–å…¨å¹³å°éœ€æ±‚ï¼š

### åŸºç¡€è¿è¡Œæ¨¡å¼

- **EditorSimulateMode** - ç¼–è¾‘å™¨æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆä»…ç¼–è¾‘å™¨å¯ç”¨ï¼‰
- **OfflinePlayMode** - å•æœºè¿è¡Œæ¨¡å¼ï¼ˆä» StreamingAssets åŠ è½½ï¼‰
- **HostPlayMode** - è”æœºè¿è¡Œæ¨¡å¼ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰

### WebGL è¿è¡Œæ¨¡å¼

- **WebPlayMode** - WebGL è¿è¡Œæ¨¡å¼ï¼ˆæ”¯æŒç½‘é¡µæ¸¸æˆï¼‰

WebGL æ¨¡å¼ä¸‹æ”¯æŒä¸¤ç§èµ„æºåŠ è½½æ–¹å¼ï¼ˆé€šè¿‡ `LoadResWayWebGL` é…ç½®ï¼‰ï¼š

- **Remote** - è®¿é—®è¿œç¨‹èµ„æºï¼ˆé»˜è®¤ï¼‰
- **StreamingAssets** - è·³è¿‡è¿œç¨‹ä¸‹è½½èµ„æºï¼Œç›´æ¥è®¿é—® StreamingAssets

### å°æ¸¸æˆå¹³å°æ”¯æŒ

TEngine èµ„æºæ¨¡å—ç‰¹åˆ«ä¼˜åŒ–äº†å¯¹å„ç§å°æ¸¸æˆå¹³å°çš„æ”¯æŒï¼š

- **å¾®ä¿¡å°æ¸¸æˆ** - è‡ªåŠ¨é€‚é…å¾®ä¿¡å°æ¸¸æˆçš„æ–‡ä»¶ç³»ç»Ÿ
- **å…¶ä»–å°æ¸¸æˆå¹³å°** - å¯é€šè¿‡é…ç½®é€‚é…ä¸åŒçš„å°æ¸¸æˆå¹³å°

> **æ³¨æ„**ï¼š
> - ç¼–è¾‘å™¨æ¨¡å¼ä¸‹ä»¥é¡¶éƒ¨å¯¼èˆªæ çš„é€‰é¡¹å¡ä¸ºä¼˜å…ˆé€‰é¡¹
> - æ‰“åŒ…åä»¥ Scene åœºæ™¯ä¸­ ResourceModule è„šæœ¬çš„ Enum é€‰é¡¹å¡ä¸ºä¼˜å…ˆé€‰é¡¹ï¼ˆæ‰“åŒ…åä¸ä¼šèµ° EditorSimulateModeï¼‰
> - WebGL å¹³å°ä¼šæ ¹æ® `LoadResWayWebGL` è®¾ç½®è‡ªåŠ¨é€‰æ‹©èµ„æºåŠ è½½æ–¹å¼

---

## âš™ï¸ é…ç½®è¯´æ˜

### Scene çª—å£é…ç½®

åœ¨ Scene çª—å£çš„ Resource å¯¹è±¡å¯ä»¥è®¾ç½®èµ„æºæ¨¡å—çš„å¸¸ç”¨é…ç½®ï¼š

- æ‰“åŒ…åçš„èµ„æºæ¨¡å¼ï¼ˆPlayModeï¼‰
- èµ„æºæ ¡éªŒç­‰çº§
- è‡ªåŠ¨å¸è½½èµ„æºé—´éš”
- èµ„æºå¯¹è±¡æ± å®¹é‡å’Œè¿‡æœŸæ—¶é—´

![image](src/3-1-1.png)

### TEngineSetting é…ç½®

åœ¨èœå•çª—å£ `TEngineSetting` å¯ä»¥è®¾ç½®èµ„æºæ¨¡å—çš„çƒ­æ›´æ–°é…ç½®ï¼š

- èµ„æºæœåŠ¡å™¨åœ°å€ï¼ˆHostServerURLï¼‰
- å¤‡ç”¨æœåŠ¡å™¨åœ°å€ï¼ˆFallbackHostServerURLï¼‰
- **WebGL èµ„æºåŠ è½½æ–¹å¼**ï¼ˆLoadResWayWebGLï¼‰
  - Remoteï¼šè®¿é—®è¿œç¨‹èµ„æº
  - StreamingAssetsï¼šç›´æ¥è®¿é—® StreamingAssets
- åœ¨çº¿å‚æ•°é…ç½®

> **æç¤º**ï¼š
> - åœ¨ `Tools/FileServer` ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåŸºäº Node çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥æŠŠåœ¨çº¿å‚æ•°ä»¥åŠ AB æ”¾å…¥ç”¨äºåšçƒ­æ›´æ–°æµ‹è¯•
> - WebGL å¹³å°éœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©èµ„æºåŠ è½½æ–¹å¼ï¼š
>   - å¼€å‘é˜¶æ®µå¯ä½¿ç”¨ StreamingAssets å¿«é€Ÿæµ‹è¯•
>   - ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Remote æ–¹å¼ï¼Œæ”¯æŒçƒ­æ›´æ–°

![image](src/3-1-2.png)

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### AssetsReference - èµ„æºå¼•ç”¨è‡ªåŠ¨åŒ–ç®¡ç†

**AssetsReference** æ˜¯ TEngine èµ„æºæ¨¡å—çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ç°äº†**å®Œå…¨è‡ªåŠ¨åŒ–çš„èµ„æºå¼•ç”¨ç®¡ç†**ã€‚

#### å·¥ä½œåŸç†

1. **è‡ªåŠ¨ç»‘å®š**ï¼šåŠ è½½ GameObject æ—¶ï¼Œæ¡†æ¶è‡ªåŠ¨æ·»åŠ  `AssetsReference` ç»„ä»¶
2. **å¼•ç”¨è¿½è¸ª**ï¼šç»„ä»¶è‡ªåŠ¨è¿½è¸ªèµ„æºå¼•ç”¨å…³ç³»
3. **è‡ªåŠ¨é‡Šæ”¾**ï¼šå½“ GameObject è¢«é”€æ¯æ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾å…³è”çš„èµ„æº

#### ä½¿ç”¨ç¤ºä¾‹

```csharp
// æ–¹å¼1ï¼šåŒæ­¥åŠ è½½ GameObjectï¼ˆè‡ªåŠ¨æ·»åŠ  AssetsReferenceï¼‰
GameObject go = GameModule.Resource.LoadGameObject("UI/BattleMainUI");
// æ— éœ€æ‰‹åŠ¨ç®¡ç†ï¼ŒDestroy æ—¶è‡ªåŠ¨é‡Šæ”¾èµ„æº

// æ–¹å¼2ï¼šå¼‚æ­¥åŠ è½½ GameObjectï¼ˆè‡ªåŠ¨æ·»åŠ  AssetsReferenceï¼‰
GameObject go = await GameModule.Resource.LoadGameObjectAsync("UI/BattleMainUI");
// åŒæ ·æ— éœ€æ‰‹åŠ¨ç®¡ç†

// æ–¹å¼3ï¼šæ‰‹åŠ¨ç»‘å®šèµ„æºå¼•ç”¨ï¼ˆç”¨äºåŠ¨æ€åŠ è½½çš„èµ„æºï¼‰
GameObject instance = Instantiate(prefab);
AssetsReference.Ref(prefab, instance, GameModule.Resource);
// æˆ–è€…ç»‘å®šå…¶ä»–èµ„æºå¯¹è±¡
AssetsReference.Ref<Material>(material, instance, GameModule.Resource);
```

#### ä¼˜åŠ¿è¯´æ˜

- âœ… **é›¶æ‰‹åŠ¨ç®¡ç†**ï¼šå¼€å‘è€…æ— éœ€å…³å¿ƒèµ„æºé‡Šæ”¾ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†
- âœ… **é˜²æ­¢å†…å­˜æ³„æ¼**ï¼šè‡ªåŠ¨è¿½è¸ªæ‰€æœ‰èµ„æºå¼•ç”¨ï¼Œç¡®ä¿æ­£ç¡®é‡Šæ”¾
- âœ… **æ”¯æŒåµŒå¥—å¼•ç”¨**ï¼šå¯ä»¥ç»‘å®šå¤šä¸ªèµ„æºå¯¹è±¡åˆ°ä¸€ä¸ª GameObject
- âœ… **å…‹éš†å®‰å…¨**ï¼šè‡ªåŠ¨å¤„ç† GameObject å…‹éš†æ—¶çš„å¼•ç”¨å…³ç³»

### AssetObject - èµ„æºå¯¹è±¡æ± 

TEngine åœ¨ YooAsset åŸºç¡€ä¸Šæ„å»ºäº†èµ„æºå¯¹è±¡æ± ç³»ç»Ÿï¼Œæä¾›ï¼š

- **æ™ºèƒ½å¤ç”¨**ï¼šç›¸åŒèµ„æºåªåŠ è½½ä¸€æ¬¡ï¼Œåç»­ç›´æ¥å¤ç”¨
- **è‡ªåŠ¨ç®¡ç†**ï¼šèµ„æºå¯¹è±¡æ± è‡ªåŠ¨ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
- **å¯é…ç½®ç­–ç•¥**ï¼šæ”¯æŒ LRUã€ARC ç­‰ç¼“å­˜ç­–ç•¥

### èµ„æºç»„ç®¡ç†ï¼ˆAssetGroupï¼‰

è™½ç„¶å½“å‰ç‰ˆæœ¬ä¸»è¦ä½¿ç”¨ `AssetsReference` è¿›è¡Œèµ„æºç®¡ç†ï¼Œä½†æ¡†æ¶ä»æ”¯æŒèµ„æºç»„æ¦‚å¿µï¼š

- èµ„æºåˆ†ç»„ç»‘å®šç®¡ç†
- èµ„æºç”Ÿå‘½å‘¨æœŸæ‰˜ç®¡ç»™èµ„æºç»„çš„æ ¹èŠ‚ç‚¹
- é€‚åˆæ‰¹é‡èµ„æºç®¡ç†åœºæ™¯

---

## ğŸ–¼ï¸ SetSprite æ¥å£ - å›¾ç‰‡è‡ªåŠ¨ç®¡ç†

TEngine èµ„æºæ¨¡å—æä¾›äº† **SetSprite** æ‰©å±•æ¥å£ï¼Œå®ç°äº†**å®Œå…¨è‡ªåŠ¨åŒ–çš„å›¾ç‰‡è®¾ç½®å’Œå¼•ç”¨ç®¡ç†**ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

1. **ğŸ”— è‡ªåŠ¨å¼•ç”¨ç®¡ç†**
   - è‡ªåŠ¨ç»‘å®šå›¾ç‰‡èµ„æºå¼•ç”¨
   - å›¾ç‰‡æ›´æ¢æ—¶è‡ªåŠ¨é‡Šæ”¾æ—§èµ„æº
   - ç»„ä»¶é”€æ¯æ—¶è‡ªåŠ¨é‡Šæ”¾èµ„æº

2. **âš¡ å¼‚æ­¥åŠ è½½æ”¯æŒ**
   - åŸºäº UniTask çš„å¼‚æ­¥åŠ è½½
   - ä¸é˜»å¡ä¸»çº¿ç¨‹
   - æ”¯æŒå–æ¶ˆæ“ä½œ

3. **ğŸ¯ æ™ºèƒ½èµ„æºå¤ç”¨**
   - ç›¸åŒèµ„æºè‡ªåŠ¨å¤ç”¨
   - è‡ªåŠ¨ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
   - é˜²æ­¢èµ„æºæ³„æ¼

### ä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€ç”¨æ³•ï¼šUI Image

```csharp
using TEngine;
using UnityEngine.UI;

public class UIIcon : MonoBehaviour
{
    public Image iconImage;
    
    void Start()
    {
        // æ–¹å¼1ï¼šåŸºç¡€ç”¨æ³•ï¼ˆå¼‚æ­¥åŠ è½½ï¼Œè‡ªåŠ¨ç®¡ç†å¼•ç”¨ï¼‰
        iconImage.SetSprite("ItemIcon");
        
        // æ–¹å¼2ï¼šè®¾ç½®åŸå§‹åˆ†è¾¨ç‡
        iconImage.SetSprite("ItemIcon", setNativeSize: true);
        
        // æ–¹å¼3ï¼šå¸¦å›è°ƒ
        iconImage.SetSprite("ItemIcon", callback: (image) => {
            Debug.Log($"å›¾ç‰‡åŠ è½½å®Œæˆ: {image.sprite.name}");
        });
        
        // æ–¹å¼4ï¼šæ”¯æŒå–æ¶ˆæ“ä½œ
        var cts = new CancellationTokenSource();
        iconImage.SetSprite("ItemIcon", cancellationToken: cts.Token);
        // éœ€è¦å–æ¶ˆæ—¶ï¼šcts.Cancel();
    }
}
```

#### 2D SpriteRenderer

```csharp
using TEngine;
using UnityEngine;

public class CharacterSprite : MonoBehaviour
{
    public SpriteRenderer spriteRenderer;
    
    void Start()
    {
        // è®¾ç½® SpriteRenderer çš„å›¾ç‰‡ï¼ˆå¼‚æ­¥åŠ è½½ï¼Œè‡ªåŠ¨ç®¡ç†å¼•ç”¨ï¼‰
        spriteRenderer.SetSprite("Player");
        
        // å¸¦å›è°ƒ
        spriteRenderer.SetSprite("Player", callback: (renderer) => {
            Debug.Log($"è§’è‰²å›¾ç‰‡åŠ è½½å®Œæˆ: {renderer.sprite.name}");
        });
    }
}
```

#### å­å›¾ç‰‡ï¼ˆå›¾é›†ï¼‰æ”¯æŒ

```csharp
using TEngine;
using UnityEngine.UI;

public class UIIcon : MonoBehaviour
{
    public Image iconImage;
    
    void Start()
    {
        // ä»å›¾é›†ä¸­åŠ è½½å­å›¾ç‰‡
        // location: å›¾é›†èµ„æºåœ°å€
        // spriteName: å›¾é›†ä¸­çš„å­å›¾ç‰‡åç§°
        iconImage.SetSubSprite("CommonAtlas", "Icon_Item_001", setNativeSize: true);
        
        // SpriteRenderer ä¹Ÿæ”¯æŒå­å›¾ç‰‡
        // spriteRenderer.SetSubSprite("Atlas", "Player_Idle");
    }
}
```

### API å‚è€ƒ

```csharp
/// <summary>
/// è®¾ç½®å›¾ç‰‡ï¼ˆUI Imageï¼‰ã€‚
/// </summary>
/// <param name="image">UI Image ç»„ä»¶ã€‚</param>
/// <param name="location">èµ„æºå®šä½åœ°å€ã€‚</param>
/// <param name="setNativeSize">æ˜¯å¦ä½¿ç”¨åŸå§‹åˆ†è¾¨ç‡ã€‚</param>
/// <param name="callback">è®¾ç½®å®Œ Sprite çš„å›è°ƒã€‚</param>
/// <param name="cancellationToken">å–æ¶ˆè®¾ç½®èµ„æºçš„ Tokenã€‚</param>
public static void SetSprite(
    this Image image, 
    string location, 
    bool setNativeSize = false, 
    Action<Image> callback = null, 
    CancellationToken cancellationToken = default
);

/// <summary>
/// è®¾ç½®å›¾ç‰‡ï¼ˆ2D SpriteRendererï¼‰ã€‚
/// </summary>
/// <param name="spriteRenderer">2D SpriteRenderer ç»„ä»¶ã€‚</param>
/// <param name="location">èµ„æºå®šä½åœ°å€ã€‚</param>
/// <param name="callback">è®¾ç½®å®Œ Sprite çš„å›è°ƒã€‚</param>
/// <param name="cancellationToken">å–æ¶ˆè®¾ç½®èµ„æºçš„ Tokenã€‚</param>
public static void SetSprite(
    this SpriteRenderer spriteRenderer, 
    string location, 
    Action<SpriteRenderer> callback = null, 
    CancellationToken cancellationToken = default
);

/// <summary>
/// è®¾ç½®å­å›¾ç‰‡ï¼ˆä»å›¾é›†ä¸­åŠ è½½ï¼ŒUI Imageï¼‰ã€‚
/// </summary>
/// <param name="image">UI Image ç»„ä»¶ã€‚</param>
/// <param name="location">å›¾é›†èµ„æºå®šä½åœ°å€ã€‚</param>
/// <param name="spriteName">å›¾é›†ä¸­çš„å­å›¾ç‰‡åç§°ã€‚</param>
/// <param name="setNativeSize">æ˜¯å¦ä½¿ç”¨åŸå§‹åˆ†è¾¨ç‡ã€‚</param>
/// <param name="cancellationToken">å–æ¶ˆè®¾ç½®èµ„æºçš„ Tokenã€‚</param>
public static void SetSubSprite(
    this Image image, 
    string location, 
    string spriteName, 
    bool setNativeSize = false, 
    CancellationToken cancellationToken = default
);

/// <summary>
/// è®¾ç½®å­å›¾ç‰‡ï¼ˆä»å›¾é›†ä¸­åŠ è½½ï¼Œ2D SpriteRendererï¼‰ã€‚
/// </summary>
/// <param name="spriteRenderer">2D SpriteRenderer ç»„ä»¶ã€‚</param>
/// <param name="location">å›¾é›†èµ„æºå®šä½åœ°å€ã€‚</param>
/// <param name="spriteName">å›¾é›†ä¸­çš„å­å›¾ç‰‡åç§°ã€‚</param>
/// <param name="cancellationToken">å–æ¶ˆè®¾ç½®èµ„æºçš„ Tokenã€‚</param>
public static void SetSubSprite(
    this SpriteRenderer spriteRenderer, 
    string location, 
    string spriteName, 
    CancellationToken cancellationToken = default
);
```

### å·¥ä½œåŸç†

1. **è‡ªåŠ¨å¼•ç”¨è¿½è¸ª**ï¼šSetSprite ä¼šè‡ªåŠ¨è¿½è¸ªå›¾ç‰‡èµ„æºå¼•ç”¨
2. **æ™ºèƒ½èµ„æºé‡Šæ”¾**ï¼šå½“å›¾ç‰‡è¢«æ›´æ¢æˆ–ç»„ä»¶è¢«é”€æ¯æ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾æ—§èµ„æº
3. **èµ„æºå¤ç”¨**ï¼šç›¸åŒèµ„æºè‡ªåŠ¨å¤ç”¨ï¼Œé¿å…é‡å¤åŠ è½½
4. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šä¸ GameObject ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾

### æœ€ä½³å®è·µ

```csharp
// âœ… æ¨èï¼šä½¿ç”¨ SetSpriteï¼Œè‡ªåŠ¨ç®¡ç†èµ„æº
iconImage.SetSprite("UI/Icon/ItemIcon");

// âŒ ä¸æ¨èï¼šæ‰‹åŠ¨åŠ è½½å’Œç®¡ç†èµ„æº
var sprite = GameModule.Resource.LoadAsset<Sprite>("UI/Icon/ItemIcon");
iconImage.sprite = sprite;
// éœ€è¦æ‰‹åŠ¨ç®¡ç†èµ„æºé‡Šæ”¾ï¼Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼
```

---

## ğŸ“– API ä½¿ç”¨æŒ‡å—

### åŸºç¡€åŠ è½½ API

#### åŒæ­¥åŠ è½½èµ„æº

```csharp
// åŒæ­¥åŠ è½½èµ„æºï¼ˆè‡ªåŠ¨ç®¡ç†å¼•ç”¨ï¼‰
SkillDisplayData data = GameModule.Resource.LoadAsset<SkillDisplayData>("SkillData");

// åŒæ­¥åŠ è½½ GameObjectï¼ˆè‡ªåŠ¨æ·»åŠ  AssetsReferenceï¼‰
GameObject go = GameModule.Resource.LoadGameObject("UI/BattleMainUI", parent);
```

#### å¼‚æ­¥åŠ è½½èµ„æºï¼ˆUniTaskï¼‰

```csharp
// ä½¿ç”¨ UniTask å¼‚æ­¥åŠ è½½ï¼ˆæ¨èæ–¹å¼ï¼‰
SkillDisplayData data = await GameModule.Resource.LoadAssetAsync<SkillDisplayData>(
    "SkillData", 
    cancellationToken: cancellationToken
);

// å¼‚æ­¥åŠ è½½ GameObjectï¼ˆè‡ªåŠ¨æ·»åŠ  AssetsReferenceï¼‰
GameObject go = await GameModule.Resource.LoadGameObjectAsync(
    "UI/BattleMainUI", 
    parent: parent,
    cancellationToken: cancellationToken
);
```

#### å¼‚æ­¥åŠ è½½èµ„æºï¼ˆå›è°ƒæ–¹å¼ï¼‰

```csharp
// ä½¿ç”¨å›è°ƒæ–¹å¼å¼‚æ­¥åŠ è½½
GameModule.Resource.LoadAsset<SkillDisplayData>(
    "SkillData",
    callback: (data) => {
        // ä½¿ç”¨èµ„æº
        Debug.Log($"Loaded: {data.name}");
    }
);
```

> **é‡è¦æç¤º**ï¼š
> - èµ„æºæ¨¡å—é»˜è®¤ä½¿ç”¨ Addressable å¯å¯»å€å®šä½
> - ä¼ å…¥èµ„æºåå­—**æ— éœ€åç¼€**ï¼ˆå¦‚ "UI/BattleMainUI" è€Œä¸æ˜¯ "UI/BattleMainUI.prefab"ï¼‰
> - æ‰“åŒ…çš„èµ„æº**ä¸å¯ä»¥é‡å**

---

## ğŸ”§ å®Œæ•´ API å‚è€ƒ

### èµ„æºåŠ è½½æ¥å£

```csharp
/// <summary>
/// åŒæ­¥åŠ è½½èµ„æºã€‚
/// </summary>
/// <param name="location">èµ„æºçš„å®šä½åœ°å€ã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <typeparam name="T">è¦åŠ è½½èµ„æºçš„ç±»å‹ã€‚</typeparam>
/// <returns>èµ„æºå®ä¾‹ã€‚</returns>
T LoadAsset<T>(string location, string packageName = "") where T : UnityEngine.Object;

/// <summary>
/// åŒæ­¥åŠ è½½æ¸¸æˆç‰©ä½“å¹¶å®ä¾‹åŒ–ï¼ˆè‡ªåŠ¨æ·»åŠ  AssetsReferenceï¼‰ã€‚
/// </summary>
/// <param name="location">èµ„æºçš„å®šä½åœ°å€ã€‚</param>
/// <param name="parent">èµ„æºå®ä¾‹çˆ¶èŠ‚ç‚¹ã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <returns>èµ„æºå®ä¾‹ã€‚</returns>
/// <remarks>ä¼šå®ä¾‹åŒ–èµ„æºåˆ°åœºæ™¯ï¼Œæ— éœ€ä¸»åŠ¨UnloadAssetï¼ŒDestroyæ—¶è‡ªåŠ¨UnloadAssetã€‚</remarks>
GameObject LoadGameObject(string location, Transform parent = null, string packageName = "");

/// <summary>
/// å¼‚æ­¥åŠ è½½èµ„æºï¼ˆUniTaskï¼‰ã€‚
/// </summary>
/// <param name="location">èµ„æºå®šä½åœ°å€ã€‚</param>
/// <param name="cancellationToken">å–æ¶ˆæ“ä½œTokenã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <typeparam name="T">è¦åŠ è½½èµ„æºçš„ç±»å‹ã€‚</typeparam>
/// <returns>å¼‚æ­¥èµ„æºå®ä¾‹ã€‚</returns>
UniTask<T> LoadAssetAsync<T>(string location, CancellationToken cancellationToken = default, string packageName = "") where T : UnityEngine.Object;

/// <summary>
/// å¼‚æ­¥åŠ è½½æ¸¸æˆç‰©ä½“å¹¶å®ä¾‹åŒ–ï¼ˆè‡ªåŠ¨æ·»åŠ  AssetsReferenceï¼‰ã€‚
/// </summary>
/// <param name="location">èµ„æºå®šä½åœ°å€ã€‚</param>
/// <param name="parent">èµ„æºå®ä¾‹çˆ¶èŠ‚ç‚¹ã€‚</param>
/// <param name="cancellationToken">å–æ¶ˆæ“ä½œTokenã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <returns>å¼‚æ­¥æ¸¸æˆç‰©ä½“å®ä¾‹ã€‚</returns>
/// <remarks>ä¼šå®ä¾‹åŒ–èµ„æºåˆ°åœºæ™¯ï¼Œæ— éœ€ä¸»åŠ¨UnloadAssetï¼ŒDestroyæ—¶è‡ªåŠ¨UnloadAssetã€‚</remarks>
UniTask<GameObject> LoadGameObjectAsync(string location, Transform parent = null, CancellationToken cancellationToken = default, string packageName = "");

/// <summary>
/// å¼‚æ­¥åŠ è½½èµ„æºï¼ˆå›è°ƒæ–¹å¼ï¼‰ã€‚
/// </summary>
/// <param name="location">èµ„æºçš„å®šä½åœ°å€ã€‚</param>
/// <param name="callback">å›è°ƒå‡½æ•°ã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <typeparam name="T">è¦åŠ è½½èµ„æºçš„ç±»å‹ã€‚</typeparam>
UniTaskVoid LoadAsset<T>(string location, Action<T> callback, string packageName = "") where T : UnityEngine.Object;
```

### èµ„æºç®¡ç†æ¥å£

```csharp
/// <summary>
/// å¸è½½èµ„æºã€‚
/// </summary>
/// <param name="asset">è¦å¸è½½çš„èµ„æºã€‚</param>
void UnloadAsset(object asset);

/// <summary>
/// èµ„æºå›æ”¶ï¼ˆå¸è½½å¼•ç”¨è®¡æ•°ä¸ºé›¶çš„èµ„æºï¼‰ã€‚
/// </summary>
void UnloadUnusedAssets();

/// <summary>
/// å¼ºåˆ¶å›æ”¶æ‰€æœ‰èµ„æºã€‚
/// </summary>
void ForceUnloadAllAssets();

/// <summary>
/// å¼ºåˆ¶æ‰§è¡Œé‡Šæ”¾æœªè¢«ä½¿ç”¨çš„èµ„æºã€‚
/// </summary>
/// <param name="performGCCollect">æ˜¯å¦ä½¿ç”¨åƒåœ¾å›æ”¶ã€‚</param>
void ForceUnloadUnusedAssets(bool performGCCollect);

/// <summary>
/// æ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨ã€‚
/// </summary>
/// <param name="location">èµ„æºå®šä½åœ°å€ã€‚</param>
/// <param name="packageName">èµ„æºåŒ…åç§°ã€‚</param>
/// <returns>æ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨çš„ç»“æœã€‚</returns>
HasAssetResult HasAsset(string location, string packageName = "");

/// <summary>
/// æ£€æŸ¥èµ„æºå®šä½åœ°å€æ˜¯å¦æœ‰æ•ˆã€‚
/// </summary>
/// <param name="location">èµ„æºçš„å®šä½åœ°å€</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
bool CheckLocationValid(string location, string packageName = "");
```

### èµ„æºåŒ…ç®¡ç†æ¥å£

```csharp
/// <summary>
/// è·å–å½“å‰èµ„æºåŒ…ç‰ˆæœ¬ã€‚
/// </summary>
/// <param name="customPackageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <returns>èµ„æºåŒ…ç‰ˆæœ¬ã€‚</returns>
string GetPackageVersion(string customPackageName = "");

/// <summary>
/// å¼‚æ­¥æ›´æ–°æœ€æ–°åŒ…çš„ç‰ˆæœ¬ã€‚
/// </summary>
/// <param name="appendTimeTicks">è¯·æ±‚URLæ˜¯å¦éœ€è¦å¸¦æ—¶é—´æˆ³ã€‚</param>
/// <param name="timeout">è¶…æ—¶æ—¶é—´ã€‚</param>
/// <param name="customPackageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <returns>è¯·æ±‚è¿œç«¯åŒ…è£¹çš„æœ€æ–°ç‰ˆæœ¬æ“ä½œå¥æŸ„ã€‚</returns>
RequestPackageVersionOperation RequestPackageVersionAsync(bool appendTimeTicks = false, int timeout = 60, string customPackageName = "");

/// <summary>
/// å‘ç½‘ç»œç«¯è¯·æ±‚å¹¶æ›´æ–°æ¸…å•ã€‚
/// </summary>
/// <param name="packageVersion">æ›´æ–°çš„åŒ…è£¹ç‰ˆæœ¬</param>
/// <param name="timeout">è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤å€¼ï¼š60ç§’ï¼‰</param>
/// <param name="customPackageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
UpdatePackageManifestOperation UpdatePackageManifestAsync(string packageVersion, int timeout = 60, string customPackageName = "");

/// <summary>
/// åˆ›å»ºèµ„æºä¸‹è½½å™¨ï¼Œç”¨äºä¸‹è½½å½“å‰èµ„æºç‰ˆæœ¬æ‰€æœ‰çš„èµ„æºåŒ…æ–‡ä»¶ã€‚
/// </summary>
/// <param name="customPackageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
ResourceDownloaderOperation CreateResourceDownloader(string customPackageName = "");

/// <summary>
/// æ¸…ç†åŒ…è£¹æœªä½¿ç”¨çš„ç¼“å­˜æ–‡ä»¶ã€‚
/// </summary>
/// <param name="clearMode">æ–‡ä»¶æ¸…ç†æ–¹å¼ã€‚</param>
/// <param name="customPackageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
ClearCacheFilesOperation ClearCacheFilesAsync(
    EFileClearMode clearMode = EFileClearMode.ClearUnusedBundleFiles, string customPackageName = "");

/// <summary>
/// æ¸…ç†æ²™ç›’è·¯å¾„ã€‚
/// </summary>
/// <param name="customPackageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
void ClearAllBundleFiles(string customPackageName = "");
```

### èµ„æºä¿¡æ¯æ¥å£

```csharp
/// <summary>
/// è·å–èµ„æºä¿¡æ¯ã€‚
/// </summary>
/// <param name="location">èµ„æºçš„å®šä½åœ°å€ã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <returns>èµ„æºä¿¡æ¯ã€‚</returns>
AssetInfo GetAssetInfo(string location, string packageName = "");

/// <summary>
/// è·å–èµ„æºä¿¡æ¯åˆ—è¡¨ã€‚
/// </summary>
/// <param name="resTag">èµ„æºæ ‡ç­¾ã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <returns>èµ„æºä¿¡æ¯åˆ—è¡¨ã€‚</returns>
AssetInfo[] GetAssetInfos(string resTag, string packageName = "");

/// <summary>
/// è·å–èµ„æºä¿¡æ¯åˆ—è¡¨ã€‚
/// </summary>
/// <param name="tags">èµ„æºæ ‡ç­¾åˆ—è¡¨ã€‚</param>
/// <param name="packageName">æŒ‡å®šèµ„æºåŒ…çš„åç§°ã€‚ä¸ä¼ ä½¿ç”¨é»˜è®¤èµ„æºåŒ…</param>
/// <returns>èµ„æºä¿¡æ¯åˆ—è¡¨ã€‚</returns>
AssetInfo[] GetAssetInfos(string[] tags, string packageName = "");
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨ LoadGameObject

å¯¹äº GameObject èµ„æºï¼Œä¼˜å…ˆä½¿ç”¨ `LoadGameObject` æˆ– `LoadGameObjectAsync`ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨æ·»åŠ  `AssetsReference` ç»„ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†ã€‚

```csharp
// âœ… æ¨èï¼šè‡ªåŠ¨ç®¡ç†èµ„æºå¼•ç”¨
GameObject ui = await GameModule.Resource.LoadGameObjectAsync("UI/BattleMainUI", parent);
// é”€æ¯æ—¶è‡ªåŠ¨é‡Šæ”¾èµ„æº
Destroy(ui);

// âŒ ä¸æ¨èï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†
AssetHandle handle = GameModule.Resource.LoadAssetAsyncHandle<GameObject>("UI/BattleMainUI");
GameObject ui = Instantiate(handle.AssetObject as GameObject);
// éœ€è¦æ‰‹åŠ¨ handle.Dispose()
```

### 2. ä½¿ç”¨ AssetsReference ç»‘å®šåŠ¨æ€èµ„æº

å¯¹äºåŠ¨æ€åŠ è½½çš„èµ„æºï¼ˆå¦‚ Materialã€Texture ç­‰ï¼‰ï¼Œä½¿ç”¨ `AssetsReference` ç»‘å®šå¼•ç”¨ï¼š

```csharp
GameObject instance = Instantiate(prefab);

// ç»‘å®šé¢„åˆ¶ä½“å¼•ç”¨
AssetsReference.Ref(prefab, instance, GameModule.Resource);

// ç»‘å®šæè´¨å¼•ç”¨
Material mat = GameModule.Resource.LoadAsset<Material>("Materials/MyMaterial");
AssetsReference.Ref(mat, instance, GameModule.Resource);
```

### 3. åˆç†ä½¿ç”¨èµ„æºåŒ…

å¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªèµ„æºåŒ…æ¥ç®¡ç†ä¸åŒæ¨¡å—çš„èµ„æºï¼š

```csharp
// åˆå§‹åŒ–è‡ªå®šä¹‰èµ„æºåŒ…
await GameModule.Resource.InitPackage("BattlePackage", needInitMainFest: true);

// ä»æŒ‡å®šèµ„æºåŒ…åŠ è½½
GameObject go = await GameModule.Resource.LoadGameObjectAsync(
    "BattleUI", 
    packageName: "BattlePackage"
);
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **èµ„æºå‘½å**ï¼šæ‰“åŒ…çš„èµ„æºä¸èƒ½é‡åï¼Œä½¿ç”¨ Addressable åœ°å€ä½œä¸ºå”¯ä¸€æ ‡è¯†
2. **èµ„æºåç¼€**ï¼šåŠ è½½èµ„æºæ—¶æ— éœ€æ·»åŠ æ–‡ä»¶åç¼€ï¼ˆå¦‚ .prefabã€.png ç­‰ï¼‰
3. **ç”Ÿå‘½å‘¨æœŸ**ï¼šèµ„æºæ¨¡å—çš„åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå·²åœ¨æµç¨‹æ¨¡å—ä¸­å®ç°ï¼Œä¸€èˆ¬æ— éœ€æ‰‹åŠ¨è°ƒç”¨
4. **å†…å­˜ç®¡ç†**ï¼šæ¡†æ¶ä¼šè‡ªåŠ¨ç®¡ç†èµ„æºå¼•ç”¨ï¼Œä½†å»ºè®®å®šæœŸè°ƒç”¨ `UnloadUnusedAssets()` é‡Šæ”¾æœªä½¿ç”¨èµ„æº

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [YooAsset å®˜æ–¹æ–‡æ¡£](https://github.com/tuyoogame/YooAsset)
- [æµç¨‹æ¨¡å—æ–‡æ¡£](./3-7-æµç¨‹æ¨¡å—.md) - äº†è§£èµ„æºæ¨¡å—çš„åˆå§‹åŒ–æµç¨‹
- [UI æ¨¡å—æ–‡æ¡£](./3-5-UIæ¨¡å—.md) - UI æ¨¡å—å¦‚ä½•ä½¿ç”¨èµ„æºæ¨¡å—
