# 3-4. å¯¹è±¡æ± æ¨¡å— - ObjectModule

## ğŸ® æ¨¡å—æ¦‚è¿°

å¯¹è±¡æ± æ¨¡å—æ˜¯ TEngine æ¡†æ¶ä¸­çš„**ä¸­é‡çº§å¯¹è±¡ç®¡ç†å·¥å…·**ï¼Œåœ¨å®¢æˆ·ç«¯å¼€å‘ä¸­æ˜¯ä¸€ä¸ªç»å¸¸ä½¿ç”¨çš„æŠ€æœ¯ã€‚å¯¹è±¡æ± é€šè¿‡å¯¹è±¡å¤ç”¨æœºåˆ¶ï¼Œå‡å°‘ GameObject çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€ï¼Œæå‡æ¸¸æˆæ€§èƒ½ã€‚

### âœ¨ æ ¸å¿ƒä¼˜åŠ¿

1. **ğŸ”„ å¯¹è±¡å¤ç”¨**
   - å‡å°‘ GameObject çš„åˆ›å»ºå’Œé”€æ¯
   - é™ä½å†…å­˜åˆ†é…å’Œ GC å‹åŠ›
   - æå‡æ¸¸æˆæ€§èƒ½

2. **ğŸ¯ çµæ´»çš„å¯¹è±¡æ± ç±»å‹**
   - æ”¯æŒå•æ¬¡è·å–å¯¹è±¡æ± 
   - æ”¯æŒå…è®¸å¤šæ¬¡è·å–å¯¹è±¡æ± 
   - å¯é…ç½®å¯¹è±¡æ± å®¹é‡å’Œè¿‡æœŸæ—¶é—´

3. **ğŸ›¡ï¸ è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - å¯¹è±¡è·å–æ—¶è‡ªåŠ¨åˆå§‹åŒ–
   - å¯¹è±¡é‡Šæ”¾æ—¶è‡ªåŠ¨æ¸…ç†
   - æ”¯æŒå¯¹è±¡æ± è‡ªåŠ¨é‡Šæ”¾

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. å®šä¹‰å¯¹è±¡ç±»

å¯¹è±¡ç±»éœ€è¦ç»§æ‰¿ `ObjectBase`ï¼š

```csharp
/// <summary>
/// Actor å¯¹è±¡ã€‚
/// </summary>
public class Actor : ObjectBase
{
    private GameObject _target;
    
    /// <summary>
    /// åˆ›å»º Actor å¯¹è±¡ã€‚
    /// </summary>
    /// <param name="name">å¯¹è±¡åç§°ã€‚</param>
    /// <param name="target">å¯¹è±¡æŒæœ‰å®ä¾‹ã€‚</param>
    /// <returns>Actor å¯¹è±¡å®ä¾‹ã€‚</returns>
    public static Actor Create(string name, object target)
    {
        var actor = MemoryPool.Acquire<Actor>();
        actor.Initialize(name, target);
        return actor;
    }
    
    /// <summary>
    /// é‡Šæ”¾å¯¹è±¡ã€‚
    /// </summary>
    /// <param name="isShutdown">æ˜¯å¦æ˜¯å…³é—­å¯¹è±¡æ± æ—¶è§¦å‘ã€‚</param>
    protected override void Release(bool isShutdown)
    {
        _target = null;
    }
}
```

### 2. åˆ›å»ºå¯¹è±¡æ± 

```csharp
public class ActorManager
{
    /// <summary>
    /// Actor å¯¹è±¡æ± ã€‚
    /// </summary>
    private IObjectPool<Actor> _actorPool;
    
    void Start()
    {
        // åˆ›å»ºå…è®¸å•æ¬¡è·å–çš„å¯¹è±¡æ± 
        _actorPool = GameModule.ObjectPool.CreateSingleSpawnObjectPool<Actor>(
            Utility.Text.Format("Actor Instance Pool ({0})", name)
        );
    }
}
```

### 3. ä½¿ç”¨å¯¹è±¡æ± 

```csharp
/// <summary>
/// åˆ›å»º Actor å¯¹è±¡ã€‚
/// </summary>
/// <param name="actorName">å¯¹è±¡åç§°ã€‚</param>
/// <param name="target">å¯¹è±¡æŒæœ‰å®ä¾‹ã€‚</param>
/// <returns>Actor å¯¹è±¡å®ä¾‹ã€‚</returns>
public Actor CreateActor(string actorName, GameObject target)
{
    Actor ret = null;
    
    if (_actorPool.CanSpawn())
    {
        // ä»å¯¹è±¡æ± ä¸­è·å–
        ret = _actorPool.Spawn();
    }
    else
    {
        // åˆ›å»ºæ–°å¯¹è±¡å¹¶æ³¨å†Œåˆ°å¯¹è±¡æ± 
        ret = Actor.Create(actorName, target);
        _actorPool.Register(ret, true);
    }
    
    return ret;
}

/// <summary>
/// é‡Šæ”¾ Actor å¯¹è±¡ã€‚
/// </summary>
/// <param name="actor">è¦é‡Šæ”¾çš„å¯¹è±¡ã€‚</param>
public void ReleaseActor(Actor actor)
{
    if (actor != null)
    {
        _actorPool.Unspawn(actor);
    }
}
```

---

## ğŸ”§ API å‚è€ƒ

### å¯¹è±¡æ± åˆ›å»º

```csharp
/// <summary>
/// åˆ›å»ºå…è®¸å•æ¬¡è·å–çš„å¯¹è±¡æ± ã€‚
/// </summary>
/// <typeparam name="T">å¯¹è±¡ç±»å‹ï¼ˆå¿…é¡»ç»§æ‰¿ ObjectBaseï¼‰ã€‚</typeparam>
/// <param name="name">å¯¹è±¡æ± åç§°ã€‚</param>
/// <param name="capacity">å¯¹è±¡æ± å®¹é‡ã€‚</param>
/// <param name="expireTime">å¯¹è±¡è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ã€‚</param>
/// <param name="priority">å¯¹è±¡æ± ä¼˜å…ˆçº§ã€‚</param>
/// <returns>å¯¹è±¡æ± å®ä¾‹ã€‚</returns>
IObjectPool<T> CreateSingleSpawnObjectPool<T>(
    string name,
    int capacity = int.MaxValue,
    float expireTime = float.MaxValue,
    int priority = 0
) where T : ObjectBase;

/// <summary>
/// åˆ›å»ºå…è®¸å¤šæ¬¡è·å–çš„å¯¹è±¡æ± ã€‚
/// </summary>
IObjectPool<T> CreateMultiSpawnObjectPool<T>(
    string name,
    int capacity = int.MaxValue,
    float expireTime = float.MaxValue,
    int priority = 0
) where T : ObjectBase;
```

### å¯¹è±¡æ± æ“ä½œ

```csharp
/// <summary>
/// ä»å¯¹è±¡æ± è·å–å¯¹è±¡ã€‚
/// </summary>
T Spawn();

/// <summary>
/// é‡Šæ”¾å¯¹è±¡å›å¯¹è±¡æ± ã€‚
/// </summary>
void Unspawn(T obj);

/// <summary>
/// æ³¨å†Œå¯¹è±¡åˆ°å¯¹è±¡æ± ã€‚
/// </summary>
void Register(T obj, bool spawned);

/// <summary>
/// æ£€æŸ¥æ˜¯å¦å¯ä»¥è·å–å¯¹è±¡ã€‚
/// </summary>
bool CanSpawn();
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é€‚åˆä½¿ç”¨å¯¹è±¡æ± çš„åœºæ™¯

- âœ… é¢‘ç¹åˆ›å»º/é”€æ¯çš„ GameObjectï¼ˆå¦‚å­å¼¹ã€ç‰¹æ•ˆï¼‰
- âœ… UI åˆ—è¡¨é¡¹ï¼ˆå¦‚èƒŒåŒ…ç‰©å“ã€èŠå¤©æ¶ˆæ¯ï¼‰
- âœ… æ¸¸æˆå®ä½“ï¼ˆå¦‚æ•Œäººã€NPCï¼‰

### 2. å¯¹è±¡æ± ç±»å‹é€‰æ‹©

```csharp
// å•æ¬¡è·å–å¯¹è±¡æ± ï¼šåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡è¢«è·å–
// é€‚åˆï¼šå”¯ä¸€å¯¹è±¡ï¼ˆå¦‚ç©å®¶ã€ä¸»æ‘„åƒæœºï¼‰
var singlePool = GameModule.ObjectPool.CreateSingleSpawnObjectPool<Player>("PlayerPool");

// å¤šæ¬¡è·å–å¯¹è±¡æ± ï¼šå¯ä»¥åŒæ—¶è·å–å¤šä¸ªå¯¹è±¡
// é€‚åˆï¼šå¯å¤ç”¨çš„å¯¹è±¡ï¼ˆå¦‚å­å¼¹ã€ç‰¹æ•ˆï¼‰
var multiPool = GameModule.ObjectPool.CreateMultiSpawnObjectPool<Bullet>("BulletPool");
```

### 3. æ­£ç¡®å®ç° Release æ–¹æ³•

```csharp
// âœ… æ¨èï¼šåœ¨ Release ä¸­æ¸…ç†æ‰€æœ‰å¼•ç”¨
protected override void Release(bool isShutdown)
{
    _target = null;
    _data = null;
    // æ¸…ç†æ‰€æœ‰å¼•ç”¨ï¼Œé¿å…å†…å­˜æ³„æ¼
}
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [å†…å­˜æ± æ¨¡å—æ–‡æ¡£](./3-3-å†…å­˜æ± æ¨¡å—.md) - äº†è§£å†…å­˜æ± æ¨¡å—ï¼ˆé€‚åˆå°å¯¹è±¡ï¼‰
- [èµ„æºæ¨¡å—æ–‡æ¡£](./3-1-èµ„æºæ¨¡å—.md) - äº†è§£èµ„æºç®¡ç†
